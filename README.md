# TYPO3 Vite Demo

This project demonstrates how to integrate [Vite](https://vitejs.dev/) with [TYPO3](https://github.com/TYPO3/typo3) both as an optimized CSS/JS build pipeline and a fast local development server. This setup enables Hot Module Reloading (HMR), out-of-the-box TypeScript support, SCSS compilation, PostCSS, and especially [Vite's plugins](https://github.com/vitejs/awesome-vite#plugins) for Vue, Svelte, React, Preact, and Solid.

## Demo Features

- **Vue 3 TodoList Component** - A fully functional, accessible to-do list with Bootstrap 5.3 styling
- **Backend Integration** - Vue components available as TYPO3 content elements with FlexForm configuration
- **Session Storage** - Client-side data persistence
- **Hot Module Replacement** - Instant updates during development without page reload
- **Production Build** - Optimized, hashed assets for production deployment

## Based on

- https://github.com/fgeierst/typo3-vite-demo.git
- https://vitejs.dev/guide/backend-integration.html


## Prerequisites

- [Docker Desktop or Colima](https://ddev.readthedocs.io/en/latest/users/install/docker-installation/)
- [DDEV](https://ddev.readthedocs.io/en/latest/)
- [Mutagen](https://ddev.readthedocs.io/en/latest/users/install/performance/#mutagen) needs to be enabled for HMR


## Local Installation

```bash
git clone https://github.com/MatthiasPeltzer/typo3-vite-demo
cd typo3-vite-demo
ddev start
ddev exec cp .env.example .env
ddev composer install
```

Login via [typo3-vite-demo.ddev.site/typo3](https://typo3-vite-demo.ddev.site/typo3) using these credentials:

- Username: `johndoe`
- Password: `sD3#5GgfvtaQ`

## Development Workflow

### Vite Development Server

The development server is already running in the background (started by `ddev start`). You can control it with:

```bash
ddev vite-serve start|stop
```

Running `ddev pnpm dev` does the same, but shows Vite's output in the terminal - helpful for debugging.

### Package Management

All Vite-related files and `node_modules` are located in `packages/typo3_vite_demo/`. Use DDEV's pnpm wrapper:

```bash
ddev pnpm install              # Install dependencies
ddev pnpm add <package>        # Add a new package
ddev pnpm add -D <package>     # Add a dev dependency
```

### File Watcher

All files imported by the main entry point `packages/typo3_vite_demo/Resources/Private/JavaScript/main.js` are watched and trigger Hot Module Replacement. Edit any Vue component, SCSS file, or JavaScript module and see changes instantly in the browser.

## Production Build

Build optimized, hashed assets for production:

```bash
ddev pnpm build
```

Switch the application context to production in `.env` (or in `.ddev/config.yaml` under `web_environment`):

```bash
# TYPO3_CONTEXT="Development/Docker"
TYPO3_CONTEXT="Production/Staging"
```

The TypoScript configuration in `setup.typoscript` detects the context and determines whether TYPO3 loads:
- **Development**: Assets from Vite's dev server at `localhost:5173` (HMR enabled)
- **Production**: Optimized, hashed assets from `Resources/Public/Vite/`

Since production filenames are hashed (e.g., `main.abc123.js`), the `InsertViteAssets.php` UserFunction parses the `manifest.json` generated by Vite to inject the correct asset paths.

## Using the TodoList Component

### As a Content Element

1. Go to any TYPO3 page in the backend
2. Click "New Content"
3. Select "Vue: TodoList" from the "Plugins" tab
4. Configure the component in the "Plugin" tab:
   - **Settings Tab**: Toggle features (delete/filter/clear buttons), set max items, add predefined tasks
   - **Appearance Tab**: Customize the card title and color scheme
5. Save and view the page

### Configuration Options

The TodoList can be customized via FlexForm in the backend:

**Settings:**
- **Show Delete Button**: Enable/disable delete buttons for individual tasks
- **Show Filter Buttons**: Toggle All/Active/Done filter buttons
- **Show Clear Completed**: Show/hide the "Clear Completed" button
- **Maximum Items**: Limit the number of tasks (1-100)
- **Predefined Items**: Add default tasks (one per line)

**Appearance:**
- **Card Title**: Custom heading (default: "My To-Do List")
- **Color Scheme**: Choose from primary, success, info, warning, or danger themes

## Project Structure

```
typo3-vite-demo/
├── packages/typo3_vite_demo/          # TYPO3 Extension
│   ├── Classes/                       # PHP Classes
│   │   └── UserFunctions/
│   │       └── InsertViteAssets.php   # Manifest parser
│   ├── Configuration/
│   │   ├── FlexForms/                 # Backend configuration forms
│   │   │   └── TodoList.xml
│   │   ├── TCA/Overrides/             # Content element registration
│   │   ├── TypoScript/                # TS configuration
│   │   │   ├── setup.typoscript       # Context detection
│   │   │   └── VueComponents.typoscript
│   │   └── Services.yaml              # Dependency injection
│   ├── Resources/
│   │   ├── Private/
│   │   │   ├── JavaScript/
│   │   │   │   ├── Components/        # Vue components
│   │   │   │   │   └── TodoList.vue
│   │   │   │   └── main.js            # Entry point
│   │   │   ├── Scss/                  # Styles
│   │   │   ├── Templates/             # Fluid templates
│   │   │   └── Language/              # Translations
│   │   └── Public/
│   │       ├── Icons/                 # Custom icons
│   │       └── Vite/                  # Production build output
│   ├── package.json                   # Node dependencies
│   ├── vite.config.js                 # Vite configuration
│   └── ext_localconf.php              # Extension registration
└── .ddev/
    ├── commands/
    │   ├── web/pnpm                   # pnpm wrapper
    │   └── web/vite-serve             # Vite control script
    └── docker-compose.viteserve.yaml  # Vite service config
```

## Technical Details

### Context Detection

The setup automatically detects the TYPO3 application context:
- `Development/*` → Loads from Vite dev server (HMR)
- `Production/*` → Loads optimized build assets

### Asset Integration

**Development Mode:**
```typoscript
page.includeJSFooter.vite = http://localhost:5173/@vite/client
page.includeJSFooter.main = http://localhost:5173/Resources/Private/JavaScript/main.js
```

**Production Mode:**
```typoscript
page.headerData.20 = USER
page.headerData.20.userFunc = MatthiasPeltzer\Typo3ViteDemo\UserFunctions\InsertViteAssets->insertViteAssets
```

### Vue Component System

Vue components are automatically mounted based on `data-component` attributes in the HTML. Add new components by:
1. Creating a `.vue` file in `Resources/Private/JavaScript/Components/`
2. Importing and registering it in `main.js`
3. Adding a Fluid template with the appropriate `data-component` attribute

For backend-editable components, register them as content elements using TCA overrides and FlexForms for configuration.
